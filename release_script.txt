######
# settings

WORKINGDIR=/Users/woolrich/Desktop

OSL2GITRELEASETAG=0.2  # e.g create new release on github website: e.g. OSL2.0.2 for tag v0.2
GLEANGITRELEASETAG=0.1 # note that GLEAN contains HMMMAR as a subproject
MEGROInetsGITRELEASETAG=1.5.0

# location of repository for supplementary directories
SUPPDIRSDOWNLOADSITE=http://users.fmrib.ox.ac.uk/~woolrich/osl2
SUPPDIRSNAME=osl2_supporting_dirs # do not want file ext here

# where we will upload osl release to
OSLUPLOADDIR=woolrich@jalapeno.fmrib.ox.ac.uk:/home/fs0/woolrich/www/osl2

GITDOWNLOADSITE=https://github.com/OHBA-analysis/

######
# make dir to work in

mkdir $WORKINGDIR

######
# download current tar ball of supplementary dirs for osl2

cd $WORKINGDIR

rm -rf supporting_dirs.tar.gz
curl -L $SUPPDIRSDOWNLOADSITE/$SUPPDIRSNAME.tar.gz --output supporting_dirs.tar.gz

# untar it
rm -rf supporting_dirs

tar xvf supporting_dirs.tar.gz
rm -rf supporting_dirs.tar.gz

######
# download current github osl release

REPONAME=osl2
GITRELEASETAG=$OSL2GITRELEASETAG

cd $WORKINGDIR

rm -rf osl2/$REPONAME.tar.gz
rm -rf osl2/$REPONAME

tmp=$GITDOWNLOADSITE$REPONAME/archive/v$GITRELEASETAG.tar.gz

echo Downloading $tmp

curl -L $tmp --output osl2/$REPONAME.tar.gz

cd osl2

# untar it
rm -rf $REPONAME-$GITRELEASETAG
tar xvf $REPONAME.tar.gz
rm -rf $REPONAME.tar.gz

# rename the internal osl dir osl2
mv $REPONAME-$GITRELEASETAG $REPONAME

# update $REPONAME_version.m
cd $WORKINGDIR
rm -f osl2/$REPONAME/${REPONAME}_version.m
echo "function ret=${REPONAME}_version, ret='$REPONAME.$GITRELEASETAG';" > osl2/$REPONAME/${REPONAME}_version.m

# also put a $REPONAME_version.m in the root osl2 dir
rm -f osl2/${REPONAME}_version.m
echo "function ret=${REPONAME}_version, ret='$REPONAME.$GITRELEASETAG';" > osl2/${REPONAME}_version.m

######
# download current GLEAN osl release
# note that GLEAN contains HMMMAR as a subproject

REPONAME=GLEAN
GITRELEASETAG=$GLEANGITRELEASETAG

cd $WORKINGDIR

rm -rf osl2/$REPONAME.tar.gz
rm -rf osl2/$REPONAME

tmp=$GITDOWNLOADSITE$REPONAME/archive/v$GITRELEASETAG.tar.gz

echo Downloading $tmp

curl -L $tmp --output osl2/$REPONAME.tar.gz

cd osl2

# untar it
rm -rf $REPONAME-$GITRELEASETAG
tar xvf $REPONAME.tar.gz
rm -rf $REPONAME.tar.gz

# rename the internal osl dir osl2
mv $REPONAME-$GITRELEASETAG $REPONAME

# update $REPONAME_version.m
cd $WORKINGDIR
rm -f osl2/$REPONAME/${REPONAME}_version.m
echo "function ret=${REPONAME}_version, ret='$REPONAME.$GITRELEASETAG';" > osl2/$REPONAME/${REPONAME}_version.m

######
# download current MEG-ROI-nets osl release

REPONAME=MEG-ROI-nets
GITRELEASETAG=$MEGROInetsGITRELEASETAG

cd $WORKINGDIR

rm -rf osl2/$REPONAME.tar.gz
rm -rf osl2/$REPONAME

tmp=$GITDOWNLOADSITE$REPONAME/archive/v$GITRELEASETAG.tar.gz

echo Downloading $tmp

curl -L $tmp --output osl2/$REPONAME.tar.gz

cd osl2

# untar it
rm -rf $REPONAME-$GITRELEASETAG
tar xvf $REPONAME.tar.gz
rm -rf $REPONAME.tar.gz

# rename the internal osl dir osl2
mv $REPONAME-$GITRELEASETAG $REPONAME

# update $REPONAME_version.m
cd $WORKINGDIR
rm -f osl2/$REPONAME/${REPONAME}_version.m
echo "function ret=${REPONAME}_version, ret='$REPONAME.$GITRELEASETAG';" > osl2/$REPONAME/${REPONAME}_version.m

######
# create tar ball of osl

cd $WORKINGDIR
tar cvf osl2.tar osl2
gzip -f osl2.tar

######
# upload - this bit obviously requires write permission $OSLUPLOADDIR

scp -r osl2.tar.gz $OSLUPLOADDIR/

echo Point osl wiki to $OSLUPLOADDIR/osl2.tar.gz

